{
    "name":  "BambuLab Chamber Heater Controller",
    "nodes":  [
                  {
                      "parameters":  {
                                         "topics":  "=device/YOUR_PRINTER_SN/report",
                                         "options":  {

                                                     }
                                     },
                      "type":  "n8n-nodes-base.mqttTrigger",
                      "typeVersion":  1,
                      "position":  [
                                       -496,
                                       112
                                   ],
                      "id":  "76571201-a1a0-4738-8a7e-1b87f8f204bf",
                      "name":  "Bambu Printer Status",
                      "credentials":  {
                                          "mqtt":  {
                                                       "id":  "YOUR_MQTT_CRED_ID",
                                                       "name":  "YOUR_MQTT_CRED_NAME"
                                                   }
                                      }
                  },
                  {
                      "parameters":  {
                                         "conditions":  {
                                                            "number":  [
                                                                           {
                                                                               "value1":  "={{ $json.print.bed_target_temper }}",
                                                                               "operation":  "largerEqual",
                                                                               "value2":  "=85"
                                                                           }
                                                                       ]
                                                        }
                                     },
                      "type":  "n8n-nodes-base.if",
                      "typeVersion":  1,
                      "position":  [
                                       -256,
                                       112
                                   ],
                      "id":  "61287ed2-059a-436f-a12f-2290373d8396",
                      "name":  "Is High Temp (ASA/ABS)?"
                  },
                  {
                      "parameters":  {
                                         "method":  "POST",
                                         "url":  "https://openapi.tuyaus.com/v1.0/devices/YOUR_TUYA_DEVICE_ID/commands",
                                         "authentication":  "genericCredentialType",
                                         "genericAuthType":  "headerAuth",
                                         "sendHeaders":  true,
                                         "headerParameters":  {
                                                                  "parameters":  [
                                                                                     {
                                                                                         "name":  "sign_method",
                                                                                         "value":  "HMAC-SHA256"
                                                                                     },
                                                                                     {
                                                                                         "name":  "=client_id",
                                                                                         "value":  "={{ $json.client_id }}"
                                                                                     },
                                                                                     {
                                                                                         "name":  "t",
                                                                                         "value":  "={{ $json.t }}"
                                                                                     },
                                                                                     {
                                                                                         "name":  "sign",
                                                                                         "value":  "={{ $json.sign }}"
                                                                                     }
                                                                                 ]
                                                              },
                                         "sendBody":  true,
                                         "bodyParameters":  {
                                                                "parameters":  [
                                                                                   {
                                                                                       "name":  "commands",
                                                                                       "value":  "=[{\"code\": \"switch_1\", \"value\": true}]"
                                                                                   }
                                                                               ]
                                                            },
                                         "options":  {

                                                     }
                                     },
                      "type":  "n8n-nodes-base.httpRequest",
                      "typeVersion":  3,
                      "position":  [
                                       480,
                                       -64
                                   ],
                      "id":  "ff557d2d-dfea-4992-962d-a29f6a67cd1b",
                      "name":  "Turn Heater ON"
                  },
                  {
                      "parameters":  {
                                         "conditions":  {
                                                            "number":  [
                                                                           {
                                                                               "value1":  "={{ $json.print.chamber_temper }}",
                                                                               "value2":  "=52"
                                                                           },
                                                                           {
                                                                               "value1":  "={{ $json.print.chamber_temper }}",
                                                                               "operation":  "larger",
                                                                               "value2":  55
                                                                           }
                                                                       ]
                                                        }
                                     },
                      "type":  "n8n-nodes-base.if",
                      "typeVersion":  1,
                      "position":  [
                                       -48,
                                       -16
                                   ],
                      "id":  "1021b7b0-b73e-4347-8433-44bc7a955bdf",
                      "name":  "Check Chamber Temp"
                  },
                  {
                      "parameters":  {
                                         "jsCode":  "const clientId = \u0027YOUR_TUYA_ACCESS_ID\u0027;\nconst clientSecret = \u0027YOUR_TUYA_ACCESS_SECRET\u0027;\n\n// Get current timestamp (in milliseconds)\nconst timestamp = Date.now().toString();\n\n// Calculate Signature: HMAC-SHA256( clientId + timestamp )\nconst crypto = require(\u0027crypto\u0027);\nconst stringToSign = clientId + timestamp;\nconst sign = crypto.createHmac(\u0027sha256\u0027, clientSecret).update(stringToSign).digest(\u0027hex\u0027).toUpperCase();\n\nreturn {\n  json: {\n    client_id: clientId,\n    t: timestamp,\n    sign: sign,\n    sign_method: \u0027HMAC-SHA256\u0027\n  }\n};"
                                     },
                      "type":  "n8n-nodes-base.code",
                      "typeVersion":  2,
                      "position":  [
                                       240,
                                       -64
                                   ],
                      "id":  "dbe87bad-f4e1-4477-ac5d-13d0df6f9e35",
                      "name":  "Code in JavaScript"
                  },
                  {
                      "parameters":  {
                                         "jsCode":  "const clientId = \u0027YOUR_TUYA_ACCESS_ID\u0027;\nconst clientSecret = \u0027YOUR_TUYA_ACCESS_SECRET\u0027;\n\n// Get current timestamp (in milliseconds)\nconst timestamp = Date.now().toString();\n\n// Calculate Signature: HMAC-SHA256( clientId + timestamp )\nconst crypto = require(\u0027crypto\u0027);\nconst stringToSign = clientId + timestamp;\nconst sign = crypto.createHmac(\u0027sha256\u0027, clientSecret).update(stringToSign).digest(\u0027hex\u0027).toUpperCase();\n\nreturn {\n  json: {\n    client_id: clientId,\n    t: timestamp,\n    sign: sign,\n    sign_method: \u0027HMAC-SHA256\u0027\n  }\n};"
                                     },
                      "type":  "n8n-nodes-base.code",
                      "typeVersion":  2,
                      "position":  [
                                       176,
                                       176
                                   ],
                      "id":  "f7ae2bc1-7623-4dcb-88f9-76eb07d74768",
                      "name":  "Code in JavaScript1"
                  },
                  {
                      "parameters":  {
                                         "method":  "POST",
                                         "url":  "https://openapi.tuyaus.com/v1.0/devices/YOUR_TUYA_DEVICE_ID/commands",
                                         "authentication":  "genericCredentialType",
                                         "genericAuthType":  "headerAuth",
                                         "sendHeaders":  true,
                                         "headerParameters":  {
                                                                  "parameters":  [
                                                                                     {
                                                                                         "name":  "sign_method",
                                                                                         "value":  "HMAC-SHA256"
                                                                                     },
                                                                                     {
                                                                                         "name":  "=client_id",
                                                                                         "value":  "={{ $json.client_id }}"
                                                                                     },
                                                                                     {
                                                                                         "name":  "t",
                                                                                         "value":  "={{ $json.t }}"
                                                                                     },
                                                                                     {
                                                                                         "name":  "sign",
                                                                                         "value":  "={{ $json.sign }}"
                                                                                     }
                                                                                 ]
                                                              },
                                         "sendBody":  true,
                                         "bodyParameters":  {
                                                                "parameters":  [
                                                                                   {
                                                                                       "name":  "commands",
                                                                                       "value":  "=[{\"code\": \"switch_1\", \"value\": false}]"
                                                                                   }
                                                                               ]
                                                            },
                                         "options":  {

                                                     }
                                     },
                      "type":  "n8n-nodes-base.httpRequest",
                      "typeVersion":  3,
                      "position":  [
                                       480,
                                       176
                                   ],
                      "id":  "1db2610c-1bd2-4c4b-9322-9553f746a65d",
                      "name":  "Turn Heater OFF"
                  },
                  {
                      "parameters":  {
                                         "content":  "🔥 Chamber Heater Control\\n🤖 Bambu Lab + 🧠 n8n + 🔌 Tuya",
                                         "width":  340,
                                         "height":  120,
                                         "color":  6
                                     },
                      "type":  "n8n-nodes-base.stickyNote",
                      "typeVersion":  1,
                      "position":  [
                                       -560,
                                       -220
                                   ],
                      "id":  "sticky-title",
                      "name":  "Note: Overview"
                  },
                  {
                      "parameters":  {
                                         "content":  "📡 Printer status stream\\nLAN MQTT updates",
                                         "width":  240,
                                         "height":  90,
                                         "color":  4
                                     },
                      "type":  "n8n-nodes-base.stickyNote",
                      "typeVersion":  1,
                      "position":  [
                                       -720,
                                       40
                                   ],
                      "id":  "sticky-mqtt",
                      "name":  "Note: MQTT"
                  },
                  {
                      "parameters":  {
                                         "content":  "🧪 High-temp material?\\n🌡️ Chamber \u003c 52C =\u003e Heat",
                                         "width":  280,
                                         "height":  110,
                                         "color":  7
                                     },
                      "type":  "n8n-nodes-base.stickyNote",
                      "typeVersion":  1,
                      "position":  [
                                       -140,
                                       -200
                                   ],
                      "id":  "sticky-logic",
                      "name":  "Note: Logic"
                  },
                  {
                      "parameters":  {
                                         "content":  "🔐 Signed Tuya command\\n✅ ON: switch_1 true\\n🛑 OFF: switch_1 false",
                                         "width":  280,
                                         "height":  130,
                                         "color":  5
                                     },
                      "type":  "n8n-nodes-base.stickyNote",
                      "typeVersion":  1,
                      "position":  [
                                       320,
                                       100
                                   ],
                      "id":  "sticky-tuya",
                      "name":  "Note: Tuya"
                  }
              ],
    "pinData":  {

                },
    "connections":  {
                        "Bambu Printer Status":  {
                                                     "main":  [
                                                                  [
                                                                      {
                                                                          "node":  "Is High Temp (ASA/ABS)?",
                                                                          "type":  "main",
                                                                          "index":  0
                                                                      }
                                                                  ]
                                                              ]
                                                 },
                        "Is High Temp (ASA/ABS)?":  {
                                                        "main":  [
                                                                     [
                                                                         {
                                                                             "node":  "Check Chamber Temp",
                                                                             "type":  "main",
                                                                             "index":  0
                                                                         }
                                                                     ],
                                                                     [
                                                                         {
                                                                             "node":  "Code in JavaScript1",
                                                                             "type":  "main",
                                                                             "index":  0
                                                                         }
                                                                     ]
                                                                 ]
                                                    },
                        "Turn Heater ON":  {
                                               "main":  [
                                                            [

                                                            ]
                                                        ]
                                           },
                        "Check Chamber Temp":  {
                                                   "main":  [
                                                                [
                                                                    {
                                                                        "node":  "Code in JavaScript",
                                                                        "type":  "main",
                                                                        "index":  0
                                                                    }
                                                                ],
                                                                [
                                                                    {
                                                                        "node":  "Code in JavaScript1",
                                                                        "type":  "main",
                                                                        "index":  0
                                                                    }
                                                                ]
                                                            ]
                                               },
                        "Code in JavaScript":  {
                                                   "main":  [
                                                                [
                                                                    {
                                                                        "node":  "Turn Heater ON",
                                                                        "type":  "main",
                                                                        "index":  0
                                                                    }
                                                                ]
                                                            ]
                                               },
                        "Code in JavaScript1":  {
                                                    "main":  [
                                                                 [
                                                                     {
                                                                         "node":  "Turn Heater OFF",
                                                                         "type":  "main",
                                                                         "index":  0
                                                                     }
                                                                 ]
                                                             ]
                                                }
                    },
    "active":  false,
    "settings":  {
                     "executionOrder":  "v1"
                 },
    "versionId":  "88e3facf-1e6b-400b-a5f3-7608b8f8570e",
    "meta":  {
                 "templateCredsSetupCompleted":  true,
                 "instanceId":  "dee2869ef96bce5516d33a963e50d4194ba3eea1fc6bb316a3a265cc15582dc3"
             },
    "id":  "SIgmiQqe0WbSmEnN",
    "tags":  [

             ]
}
